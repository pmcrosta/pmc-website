---
title: "Inputs and Outputs"
author: "Peter M. Crosta"
date: last-modified
format:
  html:
    code-fold: true
    df-print: paged
    code-overflow: scroll
    toc: true
    toc-depth: 3
    toc-location: left
---

# Inputs and Outputs

This document contains comparative data on educational inputs and outcomes for Fair Haven and peer districts. Inputs include items such as teacher characteristics and per pupil expenditures. Outcomes are primarily oriented around standardized test scores. It is important to note that often what we can measure or what available measurements we have are not always the measurements that we might want or measurements at the right granularity. That said, I think it is still worth exploring the available data so that we can learn something about the production of education.

::: callout-caution
Under construction. This doc only contains plots right now. Annotations are coming soon.
:::

```{r}
#| label: setup
#| code-summary: Code - Load libraries
#| message: false
#| warning: false
#| eval: true
options(width = 120)

library(tidyverse)
library(cluster)
library(MASS)
library(ggpmisc)
library(ggrepel)
library(glue)
library(DT)
library(factoextra)
library(gt)
library(purrr)

set.seed(2024)

# Commonly used State ID numbers (staid) and Federal Local Education Authority (LEA) IDs
# for FH, Little Silver, Rumson, and Shrewsbury
fh_leaid <- "3404950"
fh_staid <- "NJ-251440"

ls_leaid <- "3408790"
ls_staid <- "NJ-252720"

rums_leaid <- "3414370"
rums_staid <- "NJ-254570"

shrews_leaid <- "3414970"
shrews_staid <- "NJ-254770"

district_name_colors <- c(
  "Fair Haven Boro" = "#4169E1",
  "Little Silver Boro" = "#1F2868",
  "Rumson Boro" = "#8640C4",
  "Shrewsbury Boro" = "#004500",
  "Other" = "darkgrey"
)

district_stleaid_colors <-  c("#4169E1", "#1F2868", "#8640C4", "#004500", "lightgrey")
names(district_stleaid_colors) <-c(fh_staid, ls_staid, rums_staid, shrews_staid, "Other")

knitr::opts_chunk$set(
    fig.width = 8,    
    fig.height = 10,
    fig.align = "center"
)

sy <- "SY2023-24"
```

```{r}
#| label: read-data
#| echo: true
#| message: false
#| warning: false
#| eval: true
#| cache: true
#| code-summary: Code - Load data

comb2324 <- read_csv("datasets/comb2324.csv")

comb2324 <- comb2324 %>%
  dplyr::mutate(
    TotalEnrollment=as.numeric(TotalEnrollment),
    student_teacher_ratio = as.numeric(student_teacher_ratio),
    student_admin_ratio = as.numeric(student_admin_ratio),
    TeacherAvgYearsExp_School = as.numeric(TeacherAvgYearsExp_School),
    TeacherAvgYearsExpInDistrict_School = as.numeric(TeacherAvgYearsExpInDistrict_School),
    PercentageOfOutOfFieldTeachers = as.numeric(PercentageOfOutOfFieldTeachers)/100,
    PercentageTeachersWithProvisionalCredentials_School =as.numeric(PercentageTeachersWithProvisionalCredentials_School)/100,
    Chronic_Abs_Pct = as.numeric(Chronic_Abs_Pct)/100,
    `Students with Disabilities`=as.numeric(`Students with Disabilities`)/100,
    MATH_ME_District=MATH_ME_District/100,
    MATH_ME_District_notdis=MATH_ME_District_notdis/100,
    MATH_ME_District_dis=MATH_ME_District_dis/100,
    ELA_ME_District=ELA_ME_District/100,
    ELA_ME_District_notdis=ELA_ME_District_notdis/100,
    ELA_ME_District_dis=ELA_ME_District_dis/100)

rc_all_comb <- read_csv("datasets/rc_all_comb.csv")

outcomes_time <- rc_all_comb %>% 
  dplyr::select(ST_LEAID, SchoolYear, DistrictName, ELA_ME_District, MATH_ME_District, disab_pct=`Students with Disabilities`,
                TotalEnrollment, mSGP_ELA, mSGP_Math, ELA_ME_District_dis, ELA_ME_District_notdis,
                MATH_ME_District_dis, MATH_ME_District_notdis, MATH_pct_level5, MATH_pct_level5_nogr8, 
                ELA_pct_level5, Chronic_Abs_Pct) %>%
  dplyr::mutate(
      SchoolYear = ifelse(SchoolYear=="2023-24", "2023-2024", SchoolYear),
    year=case_when(
      SchoolYear == "2014-2015" ~ 1,
      SchoolYear == "2015-2016" ~ 2,
      SchoolYear == "2016-2017" ~ 3,
      SchoolYear == "2017-2018" ~ 4,
      SchoolYear == "2018-2019" ~ 5,
      SchoolYear == "2019-2020" ~ 6,
      SchoolYear == "2020-2021" ~ 7,
      SchoolYear == "2021-2022" ~ 8,
      SchoolYear == "2022-2023" ~ 9,
      SchoolYear == "2023-2024" ~ 10,
    ),
    Chronic_Abs_Pct = as.numeric(Chronic_Abs_Pct)/100,
    disab_pct=as.numeric(disab_pct)/100,
    MATH_ME_District=as.numeric(MATH_ME_District)/100,
    MATH_ME_District_notdis=as.numeric(MATH_ME_District_notdis)/100,
    MATH_ME_District_dis=as.numeric(MATH_ME_District_dis)/100,
    ELA_ME_District=as.numeric(ELA_ME_District)/100,
    ELA_ME_District_notdis=as.numeric(ELA_ME_District_notdis)/100,
    ELA_ME_District_dis=as.numeric(ELA_ME_District_dis)/100,
    TotalEnrollment = as.numeric(TotalEnrollment)
    ) %>%
  dplyr::filter(ST_LEAID %in% comb2324$ST_LEAID[comb2324$hc_euclid_ward & comb2324$TotalEnrollment <1500])

#disab_pct is missing for 2014-15
outcomes_time <- outcomes_time %>% dplyr::rename(stleaid=ST_LEAID)
outcomes_time$dist_colors <- comb2324$dist_colors[match(outcomes_time$stleaid, comb2324$ST_LEAID)]
outcomes_time$dist_size <- if_else(outcomes_time$dist_colors=="Other", .5, 2)

```

# Per pupil costs

```{r}
#| label: fig-perpupil-totalcosts
#| echo: true
#| message: false
#| warning: false
#| eval: true
#| cache: true
#| fig-height: 7
#| fig-cap: "Per pupil costs"
#| code-summary: Code - Per pupil costs

comb2324 %>%
  dplyr::filter(hc_euclid_ward, TotalEnrollment < 1500) %>%
  dplyr::mutate(district_name = fct_reorder(district_name, per_pupil_cost)) %>%
  {
    ggplot(data=., aes(x=per_pupil_cost, y=district_name, fill=dist_colors)) +
    geom_bar(stat="identity", position="dodge") +
    theme_minimal() +
    labs(x="Total Budgetary Comparative Per Pupil Cost", y="") +
    ggtitle("Total District Per Pupil Cost in Peer Group", subtitle = paste0(sy, "; Source: NJ Dept of Ed.")) +
    scale_fill_manual(values=district_name_colors, guide="none") +
    scale_x_continuous(labels = scales::dollar, expand = expansion(mult = c(0, 0.1))) +
    geom_text(aes(label=scales::dollar(per_pupil_cost), x=per_pupil_cost), size=2.5, hjust=-.1) +
    theme(panel.grid.major.y = element_blank()) +
    theme(panel.grid.minor.y = element_blank()) +
    theme(panel.grid.major.x = element_line(color="grey97")) +
    theme(panel.grid.minor.x = element_blank()) 
  }

```

```{r}
#| label: fig-perpupil-instructionalcosts
#| echo: true
#| message: false
#| warning: false
#| eval: true
#| cache: true
#| fig-height: 7
#| fig-cap: "Per pupil instructional costs"
#| code-summary: Code - Per pupil instructional costs

comb2324 %>%
  dplyr::filter(hc_euclid_ward, TotalEnrollment < 1500) %>%
  dplyr::mutate(district_name = fct_reorder(district_name, per_pupil_class_instruction)) %>%
  {
    ggplot(data=., aes(x=per_pupil_class_instruction, y=district_name, fill=dist_colors)) +
      geom_bar(stat="identity", position="dodge") +
      theme_minimal() +
      labs(x="Total Per Pupil Classroom Instruction", y="") +
      ggtitle("Total District Per Pupil Classroom Instruction in Peer Group", subtitle = paste0(sy, "; Source: NJ Dept of Ed.")) +
      scale_fill_manual(values=district_name_colors, guide="none") +
      scale_x_continuous(labels = scales::dollar, expand = expansion(mult = c(0, 0.1))) +
      geom_text(aes(label=scales::dollar(per_pupil_class_instruction), x=per_pupil_class_instruction), size=2.5, hjust=-.1)  +
    theme(panel.grid.major.y = element_blank()) +
    theme(panel.grid.minor.y = element_blank()) +
    theme(panel.grid.major.x = element_line(color="grey97")) +
    theme(panel.grid.minor.x = element_blank()) 
  }
```

```{r}
#| label: fig-perpupil-admincosts
#| echo: true
#| message: false
#| warning: false
#| eval: true
#| cache: true
#| fig-height: 7
#| fig-cap: "Per pupil administrative costs"
#| code-summary: Code - Per pupil administrative costs

comb2324 %>%
  dplyr::filter(hc_euclid_ward, TotalEnrollment < 1500) %>%
  dplyr::mutate(district_name = fct_reorder(district_name, per_pupil_admin_cost)) %>%
  {
    ggplot(data=., aes(x=per_pupil_admin_cost, y=district_name, fill=dist_colors)) +
      geom_bar(stat="identity", position="dodge") +
      theme_minimal() +
      labs(x="Total Per Pupil Admin Cost", y="") +
      ggtitle("Total District Admin Cost in Peer Group", subtitle = paste0(sy, "; Source: NJ Dept of Ed.")) +
      scale_fill_manual(values=district_name_colors, guide="none") +
      scale_x_continuous(labels = scales::dollar, expand = expansion(mult = c(0, 0.1))) +
      geom_text(aes(label=scales::dollar(per_pupil_admin_cost), x=per_pupil_admin_cost), size=2.5, hjust=-.1)  +
      theme(panel.grid.major.y = element_blank()) +
      theme(panel.grid.minor.y = element_blank()) +
      theme(panel.grid.major.x = element_line(color="grey97")) +
      theme(panel.grid.minor.x = element_blank()) 
  }

```

```{r}
#| label: fig-perpupil-instructpct
#| echo: true
#| message: false
#| warning: false
#| eval: true
#| cache: true
#| fig-height: 7
#| fig-cap: "Per pupil instructional percentage"
#| code-summary: Code - Per pupil instructional percentage

comb2324 %>%
  dplyr::filter(hc_euclid_ward, TotalEnrollment < 1500) %>%
  dplyr::mutate(inst_pct = per_pupil_class_instruction/ per_pupil_cost) %>%
  dplyr::mutate(district_name = fct_reorder(district_name, inst_pct)) %>%
  {
    ggplot(data=., aes(x=inst_pct, y=district_name, fill=dist_colors)) +
      geom_bar(stat="identity", position="dodge") +
      theme_minimal() +
      labs(x="Instruction Percentage of Total Cost", y="") +
      ggtitle("Instruction Percentage of Total Cost", subtitle = paste0(sy, "; Source: NJ Dept of Ed.")) +
      scale_fill_manual(values=district_name_colors, guide="none") +
      geom_text(aes(label=scales::percent(inst_pct, accuracy = .1), x=inst_pct), size=2.5, hjust=-.1) +
      scale_x_continuous(labels = scales::label_percent(accuracy = 1), expand = expansion(mult = c(0, 0.1)))  +
      theme(panel.grid.major.y = element_blank()) +
      theme(panel.grid.minor.y = element_blank()) +
      theme(panel.grid.major.x = element_line(color="grey97")) +
      theme(panel.grid.minor.x = element_blank()) 
  }
```

# Teacher and Administrative characteristics

```{r}
#| label: fig-teacherstudent
#| echo: true
#| message: false
#| warning: false
#| eval: true
#| cache: true
#| fig-height: 6
#| fig-cap: "Student-Teacher Ratio"
#| code-summary: Code - Student-Teacher Ratio


comb2324 %>%
  dplyr::filter(hc_euclid_ward, TotalEnrollment < 1500) %>%
  dplyr::mutate(district_name = fct_reorder(district_name, student_teacher_ratio)) %>%
  {
    ggplot(data=., aes(x=student_teacher_ratio, y=district_name, fill=dist_colors)) +
      geom_bar(stat="identity", position="dodge") +
      theme_minimal() +
      labs(x="Student-Teacher Ratio", y="") +
      ggtitle("Student-Teacher Ratio", subtitle = paste0(sy, "; Source: NJ Dept of Ed.")) +
      scale_fill_manual(values=district_name_colors, guide="none") +
      scale_x_continuous(expand = expansion(mult = c(0, 0.1))) +
      geom_text(aes(label=student_teacher_ratio, x=student_teacher_ratio), size=2.5, hjust=-.1) +
      theme(panel.grid.major.y = element_blank()) +
      theme(panel.grid.minor.y = element_blank()) +
      theme(panel.grid.major.x = element_line(color="grey97")) +
      theme(panel.grid.minor.x = element_blank()) 
  }

```

```{r}
#| label: fig-adminstudent
#| echo: true
#| message: false
#| warning: false
#| eval: true
#| cache: true
#| fig-height: 6
#| fig-cap: "Student-Admin Ratio"
#| code-summary: Code - Student-Admin Ratio

comb2324 %>%
  dplyr::filter(hc_euclid_ward, TotalEnrollment < 1500) %>%
  dplyr::mutate(district_name = fct_reorder(district_name, student_admin_ratio)) %>%
  {
    ggplot(data=., aes(x=student_admin_ratio, y=district_name, fill=dist_colors)) +
      geom_bar(stat="identity", position="dodge") +
      theme_minimal() +
      labs(x="Student-Admin Ratio", y="") +
      ggtitle("Student-Admin Ratio", subtitle = paste0(sy, "; Source: NJ Dept of Ed.")) +
      scale_fill_manual(values=district_name_colors, guide="none") +
      geom_text(aes(label=student_admin_ratio, x=student_admin_ratio), size=2.5, hjust=-.1) +
      scale_x_continuous(expand = expansion(mult = c(0, 0.1))) +
      theme(panel.grid.major.y = element_blank()) +
      theme(panel.grid.minor.y = element_blank()) +
      theme(panel.grid.major.x = element_line(color="grey97")) +
      theme(panel.grid.minor.x = element_blank()) 
  }

```

```{r}
#| label: fig-teacherexperience
#| echo: true
#| message: false
#| warning: false
#| eval: true
#| cache: true
#| fig-height: 6
#| fig-cap: "Teacher years experience"
#| code-summary: Code - Teacher years experience

comb2324 %>%
  dplyr::filter(hc_euclid_ward, TotalEnrollment < 1500) %>%
  dplyr::mutate(district_name = fct_reorder(district_name, TeacherAvgYearsExp_School)) %>%
  {
    ggplot(data=., aes(x=TeacherAvgYearsExp_School, y=district_name, fill=dist_colors)) +
      geom_bar(stat="identity", position="dodge") +
      theme_minimal() +
      labs(x="Teacher Average Years of Experience", y="") +
      ggtitle("Teacher Average Years Experience", subtitle = paste0(sy, "; Source: NJ Dept of Ed.")) +
      scale_fill_manual(values=district_name_colors, guide="none") +
      geom_text(aes(label=TeacherAvgYearsExp_School, x=TeacherAvgYearsExp_School), size=2.5, hjust=-.1) +
      scale_x_continuous(expand = expansion(mult = c(0, 0.1))) +
      theme(panel.grid.major.y = element_blank()) +
      theme(panel.grid.minor.y = element_blank()) +
      theme(panel.grid.major.x = element_line(color="grey97")) +
      theme(panel.grid.minor.x = element_blank()) 
  }


```

```{r}
#| label: fig-teacherexperience-district
#| echo: true
#| message: false
#| warning: false
#| eval: true
#| cache: true
#| fig-height: 6
#| fig-cap: "Teacher years experience in district"
#| code-summary: Code - Teacher years experience in district

comb2324 %>%
  dplyr::filter(hc_euclid_ward, TotalEnrollment < 1500) %>%
  dplyr::mutate(district_name = fct_reorder(district_name, TeacherAvgYearsExpInDistrict_School)) %>%
  {
    ggplot(data=., aes(x=TeacherAvgYearsExpInDistrict_School, y=district_name, fill=dist_colors)) +
      geom_bar(stat="identity", position="dodge") +
      theme_minimal() +
      labs(x="Teacher Average Years Experience in District", y="") +
      ggtitle("Teacher Average Years Experience in District", subtitle = paste0(sy, "; Source: NJ Dept of Ed.")) +
      scale_fill_manual(values=district_name_colors, guide="none") +
      geom_text(aes(label=TeacherAvgYearsExpInDistrict_School, x=TeacherAvgYearsExpInDistrict_School), size=3, hjust=-.1) +
      scale_x_continuous(expand = expansion(mult = c(0, 0.1))) +
      theme(panel.grid.major.y = element_blank()) +
      theme(panel.grid.minor.y = element_blank()) +
      theme(panel.grid.major.x = element_line(color="grey97")) +
      theme(panel.grid.minor.x = element_blank()) 
  }

```

```{r}
#| label: fig-teacherexperience-oof
#| echo: true
#| message: false
#| warning: false
#| eval: true
#| cache: true
#| fig-height: 6
#| fig-cap: "Percentage Out of Field Teachers"
#| code-summary: Code - Percentage Out of Field Teachers


comb2324 %>%
  dplyr::filter(hc_euclid_ward, TotalEnrollment < 1500) %>%
  dplyr::mutate(district_name = fct_reorder(district_name, PercentageOfOutOfFieldTeachers)) %>%
  {
    ggplot(data=., aes(x=PercentageOfOutOfFieldTeachers, y=district_name, fill=dist_colors)) +
      geom_bar(stat="identity", position="dodge") +
      theme_minimal() +
      labs(x="Percentage Out of Field Teachers", y="") +
      ggtitle("Percentage Out of Field Teachers", subtitle = paste0(sy, "; Source: NJ Dept of Ed.")) +
      scale_fill_manual(values=district_name_colors, guide="none") +
      geom_text(aes(label=scales::percent(PercentageOfOutOfFieldTeachers, accuracy = .1), x=PercentageOfOutOfFieldTeachers), size=2.5, hjust=-.1) +
      scale_x_continuous(labels = scales::label_percent(accuracy = 1), expand = expansion(mult = c(0, 0.1)))  +
      theme(panel.grid.major.y = element_blank()) +
      theme(panel.grid.minor.y = element_blank()) +
      theme(panel.grid.major.x = element_line(color="grey97")) +
      theme(panel.grid.minor.x = element_blank()) 
  }

```

```{r}
#| label: fig-teacherexperience-provisional
#| echo: true
#| message: false
#| warning: false
#| eval: true
#| cache: true
#| fig-height: 6
#| fig-cap: "Teachers with Provisional Credential"
#| code-summary: Code - Teachers with Provisional Credential

comb2324 %>%
  dplyr::filter(hc_euclid_ward, TotalEnrollment < 1500) %>%
  dplyr::mutate(district_name = fct_reorder(district_name, PercentageTeachersWithProvisionalCredentials_School)) %>%
  {
    ggplot(data=., aes(x=PercentageTeachersWithProvisionalCredentials_School, y=district_name, fill=dist_colors)) +
      geom_bar(stat="identity", position="dodge") +
      theme_minimal() +
      labs(x="Percentage of Teachers with Provisional Credential", y="") +
      ggtitle("Percentage of Teachers with Provisional Credential", subtitle =paste0(sy, "; Source: NJ Dept of Ed.")) +
      scale_fill_manual(values=district_name_colors, guide="none") +
      geom_text(aes(label=scales::percent(PercentageTeachersWithProvisionalCredentials_School, accuracy = .1), x=PercentageTeachersWithProvisionalCredentials_School), size=2.5, hjust=-.1) +
      scale_x_continuous(labels = scales::label_percent(accuracy = 1), expand = expansion(mult = c(0, 0.1)))  +
      theme(panel.grid.major.y = element_blank()) +
      theme(panel.grid.minor.y = element_blank()) +
      theme(panel.grid.major.x = element_line(color="grey97")) +
      theme(panel.grid.minor.x = element_blank()) 
  }

```

# Absences

```{r}
#| label: fig-absences-chronic
#| echo: true
#| message: false
#| warning: false
#| eval: true
#| cache: true
#| fig-height: 6
#| fig-cap: "Absences"
#| code-summary: Code - Chronic Absences

# Chronic absenteeism is defined as being absent for 10% or more of the days enrolled during the school year

comb2324 %>%
  dplyr::filter(hc_euclid_ward, TotalEnrollment < 1500) %>%
  dplyr::mutate(district_name = fct_reorder(district_name, Chronic_Abs_Pct)) %>%
  {
    ggplot(data=., aes(x=Chronic_Abs_Pct, y=district_name, fill=dist_colors)) +
      geom_bar(stat="identity", position="dodge") +
      theme_minimal() +
      labs(x="Percentage of Chronically Absent Students (absent 10% or more of enrolled days)", y="") +
      ggtitle("Percentage of Chronically Absent Students", subtitle = paste0(sy, "; Source: NJ Dept of Ed.")) +
      scale_fill_manual(values=district_name_colors, guide="none") +
      geom_text(aes(label=scales::percent(Chronic_Abs_Pct, accuracy = .1), x=Chronic_Abs_Pct), size=2.5, hjust=-.1) +
      scale_x_continuous(labels = scales::label_percent(accuracy = 1), expand = expansion(mult = c(0, 0.1)))  +
      theme(panel.grid.major.y = element_blank()) +
      theme(panel.grid.minor.y = element_blank()) +
      theme(panel.grid.major.x = element_line(color="grey97")) +
      theme(panel.grid.minor.x = element_blank())
  }

```

# Special Education

```{r}
#| label: fig-specialed
#| echo: true
#| message: false
#| warning: false
#| eval: true
#| cache: true
#| fig-height: 6
#| fig-cap: "Special Ed"
#| code-summary: Code - Special Ed
#| 
comb2324 %>%
  dplyr::filter(hc_euclid_ward, TotalEnrollment < 1500) %>%
  dplyr::mutate(district_name = fct_reorder(district_name, `Students with Disabilities`)) %>%
  {
    ggplot(data=., aes(x=`Students with Disabilities`, y=district_name, fill=dist_colors)) +
      geom_bar(stat="identity", position="dodge") +
      theme_minimal() +
      labs(x="Percent Students with Disabilities", y="") +
      ggtitle("Percent Students with Disabilities", subtitle = paste0(sy, "; Source: NJ Dept of Ed.")) +
      scale_fill_manual(values=district_name_colors, guide="none") +
      geom_text(aes(label=scales::percent(`Students with Disabilities`, accuracy = .1), x=`Students with Disabilities`), size=2.5, hjust=-.1) +
      scale_x_continuous(labels = scales::label_percent(accuracy = .1), expand = expansion(mult = c(0, 0.1)))  +
      theme(panel.grid.major.y = element_blank()) +
      theme(panel.grid.minor.y = element_blank()) +
      theme(panel.grid.major.x = element_line(color="grey97")) +
      theme(panel.grid.minor.x = element_blank()) 
  }
```

# Outcomes

## Math

```{r}
#| label: fig-outcomes-math
#| echo: true
#| message: false
#| warning: false
#| eval: true
#| cache: true
#| fig-height: 6
#| fig-cap: "Math Outcomes"
#| code-summary: Code - Math Outcomes
comb2324 %>%
  dplyr::filter(hc_euclid_ward, TotalEnrollment < 1500) %>%
  dplyr::mutate(district_name = fct_reorder(district_name, MATH_ME_District)) %>%
  {
    ggplot(data=., aes(x=MATH_ME_District, y=district_name, fill=dist_colors)) +
      geom_bar(stat="identity", position="dodge") +
      theme_minimal() +
      labs(x="Percent Meets/Exceeds in Math", y="") +
      ggtitle("Meets/Exceeds Math", subtitle = paste0(sy, "; Source: NJ Dept of Ed.")) +
      scale_fill_manual(values=district_name_colors, guide="none") +
      geom_text(aes(label=scales::percent(MATH_ME_District, accuracy = .1), x=MATH_ME_District), size=2.5, hjust=-.1) +
      scale_x_continuous(labels = scales::label_percent(accuracy = .1), expand = expansion(mult = c(0, 0.1)))  +
      theme(panel.grid.major.y = element_blank()) +
      theme(panel.grid.minor.y = element_blank()) +
      theme(panel.grid.major.x = element_line(color="grey97")) +
      theme(panel.grid.minor.x = element_blank()) 
  }

```

```{r}
#| label: fig-outcomes-math-exceeds
#| echo: true
#| message: false
#| warning: false
#| eval: true
#| cache: true
#| fig-height: 6
#| fig-cap: "Math Outcomes - Exceeds"
#| code-summary: Code - Math Outcomes - Exceeds

comb2324 %>%
  dplyr::filter(hc_euclid_ward, TotalEnrollment < 1500) %>%
  dplyr::mutate(district_name = fct_reorder(district_name, MATH_pct_level5)) %>%
  {
    ggplot(data=., aes(x=MATH_pct_level5, y=district_name, fill=dist_colors)) +
      geom_bar(stat="identity", position="dodge") +
      theme_minimal() +
      labs(x="Percent Exceeds in Math", y="") +
      ggtitle("Exceeds Math", subtitle = paste0(sy, "; Source: NJ Dept of Ed.")) +
      scale_fill_manual(values=district_name_colors, guide="none") +
      geom_text(aes(label=scales::percent(MATH_pct_level5, accuracy = .1), x=MATH_pct_level5), size=2.5, hjust=-.1) +
      scale_x_continuous(labels = scales::label_percent(accuracy = .1), expand = expansion(mult = c(0, 0.1)))  +
      theme(panel.grid.major.y = element_blank()) +
      theme(panel.grid.minor.y = element_blank()) +
      theme(panel.grid.major.x = element_line(color="grey97")) +
      theme(panel.grid.minor.x = element_blank()) 
  }
```

```{r}
#| label: fig-outcomes-math-msgp
#| echo: true
#| message: false
#| warning: false
#| eval: true
#| cache: true
#| fig-height: 6
#| fig-cap: "Math Median Growth"
#| code-summary: Code - Math Median Growth
comb2324 %>%
  dplyr::filter(hc_euclid_ward, TotalEnrollment < 1500) %>%
  dplyr::mutate(district_name = fct_reorder(district_name, mSGP_Math)) %>%
  {
    ggplot(data=., aes(x=mSGP_Math, y=district_name, fill=dist_colors)) +
      geom_bar(stat="identity", position="dodge") +
      theme_minimal() +
      labs(x="Math Median Growth Percentile", y="") +
      ggtitle("Math Median Growth", subtitle = paste0(sy, "; Source: NJ Dept of Ed.")) +
      scale_fill_manual(values=district_name_colors, guide="none") +
      geom_text(aes(label=mSGP_Math, x=mSGP_Math), size=2.5, hjust=-.1) +
      scale_x_continuous(expand = expansion(mult = c(0, 0.1)))  +
      theme(panel.grid.major.y = element_blank()) +
      theme(panel.grid.minor.y = element_blank()) +
      theme(panel.grid.major.x = element_line(color="grey97")) +
      theme(panel.grid.minor.x = element_blank()) 
  }

```

```{r}
#| label: fig-outcomes-math-nodis
#| echo: true
#| message: false
#| warning: false
#| eval: true
#| cache: true
#| fig-height: 6
#| fig-cap: "Math Outcomes - without Disabilities"
#| code-summary: Code - Math Outcomes - without Disabilities

comb2324 %>%
  dplyr::filter(hc_euclid_ward, TotalEnrollment < 1500) %>%
  dplyr::mutate(district_name = fct_reorder(district_name, MATH_ME_District_notdis)) %>%
  {
    ggplot(data=., aes(x=MATH_ME_District_notdis, y=district_name, fill=dist_colors)) +
      geom_bar(stat="identity", position="dodge") +
      theme_minimal() +
      labs(x="Percent Meets/Exceeds in Math", y="") +
      ggtitle("Meets/Exceeds Math - Students without Disabilities", subtitle = paste0(sy, "; Source: NJ Dept of Ed.")) +
      scale_fill_manual(values=district_name_colors, guide="none") +
      geom_text(aes(label=scales::percent(MATH_ME_District_notdis, accuracy = .1), x=MATH_ME_District_notdis), size=2.5, hjust=-.1) +
      scale_x_continuous(labels = scales::label_percent(accuracy = .1), expand = expansion(mult = c(0, 0.1)))  +
      theme(panel.grid.major.y = element_blank()) +
      theme(panel.grid.minor.y = element_blank()) +
      theme(panel.grid.major.x = element_line(color="grey97")) +
      theme(panel.grid.minor.x = element_blank()) 
  }

```

```{r}
#| label: fig-outcomes-math-dis
#| echo: true
#| message: false
#| warning: false
#| eval: true
#| cache: true
#| fig-height: 6
#| fig-cap: "Math Outcomes - Disabilities"
#| code-summary: Code - Math Outcomes - Disabilities

comb2324 %>%
  dplyr::filter(hc_euclid_ward, TotalEnrollment < 1500, !is.na(MATH_ME_District_dis)) %>%
  dplyr::mutate(district_name = fct_reorder(district_name, MATH_ME_District_dis)) %>% 
  {
    ggplot(data=., aes(x=MATH_ME_District_dis, y=district_name, fill=dist_colors)) +
      geom_bar(stat="identity", position="dodge") +
      theme_minimal() +
      labs(x="Percent Meets/Exceeds in Math", y="") +
      ggtitle("Meets/Exceeds Math - Students with Disabilities", subtitle = paste0(sy, "; Source: NJ Dept of Ed.")) +
      scale_fill_manual(values=district_name_colors, guide="none") +
      geom_text(aes(label=scales::percent(MATH_ME_District_dis, accuracy = .1), x=MATH_ME_District_dis), size=2.5, hjust=-.1) +
      scale_x_continuous(labels = scales::label_percent(accuracy = .1), expand = expansion(mult = c(0, 0.1)))  +
      theme(panel.grid.major.y = element_blank()) +
      theme(panel.grid.minor.y = element_blank()) +
      theme(panel.grid.major.x = element_line(color="grey97")) +
      theme(panel.grid.minor.x = element_blank()) 
  }
```

```{r}
#| label: fig-math-me-time
#| echo: true
#| message: false
#| warning: false
#| eval: true
#| cache: true
#| fig-height: 6
#| fig-cap: "Math Meets/Exceeds over Time"
#| code-summary: Code - Math Meets/Exceeds over Time

all_years <- paste(2014:2023, 2015:2024, sep = "-")
years_vector <- setNames(all_years, 1:10) # Corrected to align names and values

# Use dplyr::full_join with a dummy data frame to ensure all levels are present
data_full <- outcomes_time %>%
  full_join(data.frame(SchoolYear = factor(all_years, levels = all_years)), by = "SchoolYear") %>%
  dplyr::mutate(dist_colors = fct_relevel(dist_colors, rev(unique(outcomes_time$dist_colors))))

data_full$DistrictName <- str_trim(str_replace_all(comb2324$LEA_NAME, "School District|Borough|Boro", "")[match(data_full$stleaid, comb2324$ST_LEAID)])


ggplot(aes(x=SchoolYear, y=MATH_ME_District, group=stleaid, color=dist_colors), data=data_full)  +
  geom_line(aes(size=dist_size)) +
  #geom_smooth(aes(group=NA, color=NA), method="loess") +
  scale_x_discrete(labels = all_years, expand = expansion(add=c(.5,1.5))) +
  theme_bw() +
  scale_color_manual("District", values=district_name_colors, labels =c("Shrewsbury", "Rumson", "Little Silver", "Fair Haven", "Others"), guide='none')  +
  labs(title = "Math % Meets/Exceeds", subtitle = "Fair Haven and Peer Districts, 2014-15 to 2023-24", x="School Year", y="Percent Meets/Exceeds")  +
  scale_size(guide = 'none', range = c(0.5, 2)) +
  scale_y_continuous(labels = scales::label_percent(accuracy = 1)) +
  theme(axis.text.x = element_text(angle = 30, hjust = 1)) +
  geom_text(data = data_full %>% filter(SchoolYear == "2023-2024", dist_colors != "Other"),
            aes(label = DistrictName, x = 10.5) , hjust = 0.3,  color = "#888888", size = 3)

```

## ELA

```{r}
#| label: fig-outcomes-ela
#| echo: true
#| message: false
#| warning: false
#| eval: true
#| cache: true
#| fig-height: 6
#| fig-cap: "ELA Outcomes"
#| code-summary: Code - ELA Outcomes

comb2324 %>%
  dplyr::filter(hc_euclid_ward, TotalEnrollment < 1500) %>%
  dplyr::mutate(district_name = fct_reorder(district_name, ELA_ME_District)) %>% 
  {
    ggplot(data=., aes(x=ELA_ME_District, y=district_name, fill=dist_colors)) +
      geom_bar(stat="identity", position="dodge") +
      theme_minimal() +
      labs(x="Percent Meets/Exceeds in ELA", y="") +
      ggtitle("Meets/Exceeds ELA", subtitle = paste0(sy, "; Source: NJ Dept of Ed.")) +
      scale_fill_manual(values=district_name_colors, guide="none") +
      geom_text(aes(label=scales::percent(ELA_ME_District, accuracy = .1), x=ELA_ME_District), size=2.5, hjust=-.1) +
      scale_x_continuous(labels = scales::label_percent(accuracy = .1), expand = expansion(mult = c(0, 0.1)))  +
      theme(panel.grid.major.y = element_blank()) +
      theme(panel.grid.minor.y = element_blank()) +
      theme(panel.grid.major.x = element_line(color="grey97")) +
      theme(panel.grid.minor.x = element_blank()) 
  }

```

```{r}
#| label: fig-outcomes-ela-exceeds
#| echo: true
#| message: false
#| warning: false
#| eval: true
#| cache: true
#| fig-height: 6
#| fig-cap: "ELA Outcomes - Exceeds"
#| code-summary: Code - ELA Outcomes - Exceeds

comb2324 %>%
  dplyr::filter(hc_euclid_ward, TotalEnrollment < 1500, !is.na(ELA_pct_level5)) %>%
  dplyr::mutate(district_name = fct_reorder(district_name, ELA_pct_level5)) %>%
  {
    ggplot(data=., aes(x=ELA_pct_level5, y=district_name, fill=dist_colors)) +
      geom_bar(stat="identity", position="dodge") +
      theme_minimal() +
      labs(x="Percent Exceeds in ELA", y="") +
      ggtitle("Exceeds ELA", subtitle = paste0(sy, "; Source: NJ Dept of Ed.")) +
      scale_fill_manual(values=district_name_colors, guide="none") +
      geom_text(aes(label=scales::percent(ELA_pct_level5, accuracy = .1), x=ELA_pct_level5), size=2.5, hjust=-.1) +
      scale_x_continuous(labels = scales::label_percent(accuracy = .1), expand = expansion(mult = c(0, 0.1)))  +
      theme(panel.grid.major.y = element_blank()) +
      theme(panel.grid.minor.y = element_blank()) +
      theme(panel.grid.major.x = element_line(color="grey97")) +
      theme(panel.grid.minor.x = element_blank()) 
  }
```

```{r}
#| label: fig-outcomes-ela-msgp
#| echo: true
#| message: false
#| warning: false
#| eval: true
#| cache: true
#| fig-height: 6
#| fig-cap: "ELA Median Growth"
#| code-summary: Code - ELA Median Growth

comb2324 %>%
  dplyr::filter(hc_euclid_ward, TotalEnrollment < 1500) %>%
  dplyr::mutate(district_name = fct_reorder(district_name, mSGP_ELA)) %>%
  {
    ggplot(data=., aes(x=mSGP_ELA, y=district_name, fill=dist_colors)) +
      geom_bar(stat="identity", position="dodge") +
      theme_minimal() +
      labs(x="ELA Median Growth Percentile", y="") +
      ggtitle("ELA Median Growth", subtitle = paste0(sy, "; Source: NJ Dept of Ed.")) +
      scale_fill_manual(values=district_name_colors, guide="none") +
      geom_text(aes(label=mSGP_ELA, x=mSGP_ELA), size=2.5, hjust=-.1) +
      scale_x_continuous(expand = expansion(mult = c(0, 0.1)))  +
      theme(panel.grid.major.y = element_blank()) +
      theme(panel.grid.minor.y = element_blank()) +
      theme(panel.grid.major.x = element_line(color="grey97")) +
      theme(panel.grid.minor.x = element_blank()) 
  }

```

```{r}
#| label: fig-outcomes-ela-nodis
#| echo: true
#| message: false
#| warning: false
#| eval: true
#| cache: true
#| fig-height: 6
#| fig-cap: "ELA Outcomes - without Disabilities"
#| code-summary: Code - ELA Outcomes - without Disabilities

comb2324 %>%
  dplyr::filter(hc_euclid_ward, TotalEnrollment < 1500) %>%
  dplyr::mutate(district_name = fct_reorder(district_name, ELA_ME_District_notdis)) %>%
  {
    ggplot(data=., aes(x=ELA_ME_District_notdis, y=district_name, fill=dist_colors)) +
      geom_bar(stat="identity", position="dodge") +
      theme_minimal() +
      labs(x="Percent Meets/Exceeds in ELA", y="") +
      ggtitle("Meets/Exceeds ELA - Students without Disabilities", subtitle = paste0(sy, "; Source: NJ Dept of Ed.")) +
      scale_fill_manual(values=district_name_colors, guide="none") +
      geom_text(aes(label=scales::percent(ELA_ME_District_notdis, accuracy = .1), x=ELA_ME_District_notdis), size=2.5, hjust=-.1) +
      scale_x_continuous(labels = scales::label_percent(accuracy = .1), expand = expansion(mult = c(0, 0.1)))  +
      theme(panel.grid.major.y = element_blank()) +
      theme(panel.grid.minor.y = element_blank()) +
      theme(panel.grid.major.x = element_line(color="grey97")) +
      theme(panel.grid.minor.x = element_blank()) 
  }

```

```{r}
#| label: fig-outcomes-ela-dis
#| echo: true
#| message: false
#| warning: false
#| eval: true
#| cache: true
#| fig-height: 6
#| fig-cap: "ELA Outcomes - Disabilities"
#| code-summary: Code - ELA Outcomes - Disabilities

comb2324 %>%
  dplyr::filter(hc_euclid_ward, TotalEnrollment < 1500, !is.na(ELA_ME_District_dis)) %>%
  dplyr::mutate(district_name = fct_reorder(district_name, ELA_ME_District_dis)) %>%
  {
    ggplot(data=., aes(x=ELA_ME_District_dis, y=district_name, fill=dist_colors)) +
      geom_bar(stat="identity", position="dodge") +
      theme_minimal() +
      labs(x="Percent Meets/Exceeds in ELA", y="") +
      ggtitle("Meets/Exceeds ELA - Students with Disabilities", subtitle = paste0(sy, "; Source: NJ Dept of Ed.")) +
      scale_fill_manual(values=district_name_colors, guide="none") +
      geom_text(aes(label=scales::percent(ELA_ME_District_dis, accuracy = .1), x=ELA_ME_District_dis), size=2.5, hjust=-.1) +
      scale_x_continuous(labels = scales::label_percent(accuracy = .1), expand = expansion(mult = c(0, 0.1)))  +
      theme(panel.grid.major.y = element_blank()) +
      theme(panel.grid.minor.y = element_blank()) +
      theme(panel.grid.major.x = element_line(color="grey97")) +
      theme(panel.grid.minor.x = element_blank()) 
  }
```

```{r}
#| label: fig-ela-me-time
#| echo: true
#| message: false
#| warning: false
#| eval: true
#| cache: true
#| fig-height: 6
#| fig-cap: "ELA Meets/Exceeds over Time"
#| code-summary: Code - ELA Meets/Exceeds over Time

all_years <- paste(2014:2023, 2015:2024, sep = "-")
years_vector <- setNames(all_years, 1:10) # Corrected to align names and values

# Use dplyr::full_join with a dummy data frame to ensure all levels are present
data_full <- outcomes_time %>%
  full_join(data.frame(SchoolYear = factor(all_years, levels = all_years)), by = "SchoolYear") %>%
  dplyr::mutate(dist_colors = fct_relevel(dist_colors, rev(unique(outcomes_time$dist_colors)))) 

data_full$DistrictName <- str_trim(comb2324$district_name[match(data_full$stleaid, comb2324$ST_LEAID)])

ggplot(aes(x=SchoolYear, y=ELA_ME_District, group=stleaid, color=dist_colors), data=data_full)  +
  geom_line(aes(size=dist_size)) +
  scale_x_discrete(labels = all_years, expand = expansion(add=c(.5,1.5))) +
  theme_bw() +
  scale_color_manual("District", values=district_name_colors, labels =c("Shrewsbury", "Rumson", "Little Silver", "Fair Haven", "Others"), guide='none')  +
  labs(title = "ELA Percent Meets/Exceeds", subtitle = "Fair Haven and Peer Districts, 2014-15 to 2023-24", x="School Year", y="Percent Meets/Exceeds")  +
  scale_size(guide = 'none', range = c(0.5, 2)) +
  scale_y_continuous(labels = scales::label_percent(accuracy = 1)) +
  theme(axis.text.x = element_text(angle = 30, hjust = 1)) +
  geom_text(data = data_full %>% filter(SchoolYear == "2023-2024", dist_colors != "Other"),
            aes(label = DistrictName, x = 10.5) , hjust = 0.3, color = "#888888", size = 3)

```

# Outcomes and Inputs Math

```{r}
#| label: fig-math-vs-perpupil
#| echo: true
#| message: false
#| warning: false
#| eval: true
#| cache: true
#| fig-height: 6
#| fig-cap: "Math vs Per Pupil Expenditure"
#| code-summary: Code - Math vs Per Pupil Expenditure

# comb2324 %>% dplyr::filter(hc_euclid_ward, TotalEnrollment < 1500) %>% rlm(MATH_ME_District ~ I(per_pupil_cost/1000), data=., method = "M")

comb2324 %>%
  dplyr::filter(hc_euclid_ward, TotalEnrollment < 1500) %>%
  {
    ggplot(data=., aes(x=per_pupil_cost, y=MATH_ME_District, color=dist_colors)) +
      geom_point(aes(size=TotalEnrollment)) +
      stat_poly_line(method="rlm:M", fill="grey85") +
      #stat_poly_eq(use_label(c("eq")), method="rlm:M",  label.x = .8, label.y=1, color="black") +
      theme_minimal() +
      theme(legend.position = "bottom") +
      geom_text_repel(aes(label=.data$district_name)) +
      scale_color_manual(values=district_name_colors, guide="none") +
      labs(x="Per Pupil Expenditure", y="Percent Meets/Exceeds in Math") +
      ggtitle("Math Meets/Exceeds by Per Pupil Expenditure", subtitle = paste0(sy, "; Source: NJ Dept of Ed.")) +
      scale_size_continuous(name = "District Size")
  }

```

```{r}
#| label: fig-math-vs-perpupil-all
#| echo: true
#| message: false
#| warning: false
#| eval: true
#| cache: true
#| fig-height: 6
#| fig-cap: "Math vs Per Pupil Expenditure - All Districts"
#| code-summary: Code - Math vs Per Pupil Expenditure - All Districts

# comb2324 %>% rlm(MATH_ME_District ~ I(per_pupil_cost/1000), data=., method = "M")

comb2324 %>%
  {
    ggplot(data=., aes(x=per_pupil_cost, y=MATH_ME_District, color=dist_colors)) +
      geom_point(aes(size=TotalEnrollment)) +
      stat_poly_line(method="rlm:M", fill="grey85") +
      #stat_poly_eq(use_label(c("eq")), method="rlm:M",  label.x = .8, label.y=1, color="black") +
      theme_minimal() +
      theme(legend.position = "bottom") +
      geom_text_repel(aes(label=.data$district_name)) +
      scale_color_manual(values=district_name_colors, guide="none") +
      labs(x="Per Pupil Expenditure", y="Percent Meets/Exceeds in Math") +
      ggtitle("Math Meets/Exceeds by Per Pupil Expenditure", subtitle = paste0(sy, "; Source: NJ Dept of Ed.")) +
      scale_size_continuous(name = "District Size")
  }

```

```{r}
#| label: fig-math-vs-medianincome-all
#| echo: true
#| message: false
#| warning: false
#| eval: true
#| cache: true
#| fig-height: 6
#| fig-cap: "Math vs Median Family Income - All Districts"
#| code-summary: Code - Math vs Median Family Income - All Districts

# comb2324 %>% rlm(MATH_ME_District ~ I(Fam_Med_Income/1000), data=., method = "M")

comb2324 %>%
  {
    ggplot(data=., aes(x=Fam_Med_Income, y=MATH_ME_District, color=dist_colors)) +
      geom_point(aes(size=TotalEnrollment)) +
      stat_poly_line(method="rlm:M", fill="grey85") +
      #stat_poly_eq(use_label(c("eq")), method="rlm:M",  label.x = .8, label.y=1, color="black") +
      theme_minimal() +
      theme(legend.position = "bottom") +
      geom_text_repel(aes(label=.data$district_name)) +
      scale_color_manual(values=district_name_colors, guide="none") +
      labs(x="Median Family Income", y="Percent Meets/Exceeds in Math") +
      ggtitle("Math Meets/Exceeds by Median Family Income", subtitle = paste0(sy, "; Sources: NJ Dept of Ed., ACS-EDGE")) +
      scale_size_continuous(name = "District Size") +
      scale_x_continuous(labels = scales::dollar, expand = expansion(mult = c(0, 0.1)))
  }

```

```{r}
#| label: fig-math-vs-perpupil-exceeds
#| echo: true
#| message: false
#| warning: false
#| eval: true
#| cache: true
#| fig-height: 6
#| fig-cap: "Math Exceeds vs Per Pupil Expenditure"
#| code-summary: Code - Math Exceeds vs Per Pupil Expenditure

# comb2324 %>% dplyr::filter(hc_euclid_ward, TotalEnrollment < 1500) %>% rlm(MATH_pct_level5 ~ I(per_pupil_cost/1000), data=., method = "M")

comb2324 %>%
  dplyr::filter(hc_euclid_ward, TotalEnrollment < 1500) %>%
  {
    ggplot(data=., aes(x=per_pupil_cost, y=MATH_pct_level5, color=dist_colors)) +
      geom_point(aes(size=TotalEnrollment)) +
      stat_poly_line(method="rlm:M", fill="grey85") +
      #stat_poly_eq(use_label(c("eq")), method="rlm:M",  label.x = .8, label.y=1, color="black") +
      theme_minimal() +
      theme(legend.position = "bottom") +
      geom_text_repel(aes(label=.data$district_name)) +
      scale_color_manual(values=district_name_colors, guide="none") +
      labs(x="Per Pupil Expenditure", y="Percent Exceeds in Math") +
      ggtitle("Math Exceeds by Per Pupil Expenditure", subtitle = paste0(sy, "; Source: NJ Dept of Ed.")) +
      scale_size_continuous(name = "District Size") +
      scale_y_continuous(labels = scales::label_percent(accuracy = 1)) +
      scale_x_continuous(labels = scales::dollar, expand = expansion(mult = c(0, 0.1)))
  }

```

```{r}
#| label: fig-mathsgp-vs-perpupil
#| echo: true
#| message: false
#| warning: false
#| eval: true
#| cache: true
#| fig-height: 6
#| fig-cap: "Math Growth Percentile vs Per Pupil Expenditure"
#| code-summary: Code - Math Growth Percentile vs Per Pupil Expenditure

# comb2324 %>% dplyr::filter(hc_euclid_ward, TotalEnrollment < 1500) %>% rlm(mSGP_Math ~ I(per_pupil_cost/1000), data=., method = "M")

comb2324 %>%
  dplyr::filter(hc_euclid_ward, TotalEnrollment < 1500) %>%
  {
    ggplot(data=., aes(x=per_pupil_cost, y=mSGP_Math, color=dist_colors)) +
      geom_point(aes(size=TotalEnrollment)) +
      stat_poly_line(method="rlm:M", fill="grey85") +
      #stat_poly_eq(use_label(c("eq")), method="rlm:M",  label.x = .8, label.y=1, color="black") +
      theme_minimal() +
      theme(legend.position = "bottom") +
      geom_text_repel(aes(label=.data$district_name)) +
      scale_color_manual(values=district_name_colors, guide="none") +
      labs(x="Per Pupil Expenditure", y="Math Growth Percentile") +
      ggtitle("Math Growth Percentile by Per Pupil Expenditure", subtitle = paste0(sy, "; Source: NJ Dept of Ed.")) +
      scale_size_continuous(name = "District Size") +
      scale_x_continuous(labels = scales::dollar, expand = expansion(mult = c(0, 0.1)))
  }


```

```{r}
#| label: fig-mathsgp-vs-perpupil-all
#| echo: true
#| message: false
#| warning: false
#| eval: true
#| cache: true
#| fig-height: 6
#| fig-cap: "Math Growth Percentile vs Per Pupil Expenditure - All"
#| code-summary: Code - Math Growth Percentile vs Per Pupil Expenditure - All

# comb2324 %>% rlm(mSGP_Math ~ I(per_pupil_cost/1000), data=., method = "M")

comb2324 %>%
  {
    ggplot(data=., aes(x=per_pupil_cost, y=mSGP_Math, color=dist_colors)) +
      geom_point(aes(size=TotalEnrollment)) +
      stat_poly_line(method="rlm:M", fill="grey85") +
      theme_minimal() +
      theme(legend.position = "bottom") +
      geom_text_repel(aes(label=.data$district_name)) +
      scale_color_manual(values=district_name_colors, guide="none") +
      labs(x="Per Pupil Expenditure", y="Math Growth Percentile") +
      ggtitle("Math Growth Percentile by Per Pupil Expenditure", subtitle = paste0(sy, "; Source: NJ Dept of Ed.")) +
      scale_size_continuous(name = "District Size") +
      scale_x_continuous(labels = scales::dollar, expand = expansion(mult = c(0, 0.1)))
  }

```

```{r}
#| label: fig-math-vs-percentint
#| echo: true
#| message: false
#| warning: false
#| eval: true
#| cache: true
#| fig-height: 6
#| fig-cap: "Math vs Percent Expenditure to Instruction"
#| code-summary: Code - Math vs Percent Expenditure to Instruction

# comb2324 %>% dplyr::filter(hc_euclid_ward, TotalEnrollment < 1500) %>% rlm(MATH_ME_District ~ I(per_pupil_class_instruction/ per_pupil_cost), data=., method = "M")

comb2324 %>%
  dplyr::filter(hc_euclid_ward, TotalEnrollment < 1500) %>%
  dplyr::mutate(inst_pct = per_pupil_class_instruction/ per_pupil_cost) %>%
  {
    ggplot(data=., aes(x=inst_pct, y=MATH_ME_District, color=dist_colors)) +
      geom_point(aes(size=TotalEnrollment)) +
      stat_poly_line(method="rlm:M", fill="grey85") +
      theme_minimal() +
      theme(legend.position = "bottom") +
      geom_text_repel(aes(label=.data$district_name)) +
      scale_color_manual(values=district_name_colors, guide="none") +
      labs(x="Percent Instruction", y="Percent Meets/Exceeds in Math") +
      ggtitle("Math Meets/Exceeds by Percent Instruction", subtitle = paste0(sy, "; Source: NJ Dept of Ed.")) +
      scale_size_continuous(name = "District Size") +
      scale_x_continuous(labels = scales::label_percent(accuracy = 1))
  }

```

```{r}
#| label: fig-math-vs-avgyears
#| echo: true
#| message: false
#| warning: false
#| eval: true
#| cache: true
#| fig-height: 6
#| fig-cap: "Math vs Teacher Avg Years Exp"
#| code-summary: Code - Math vs Teacher Avg Years Exp

# comb2324 %>% dplyr::filter(hc_euclid_ward, TotalEnrollment < 1500) %>% rlm(MATH_ME_District ~ TeacherAvgYearsExp_School, data=., method = "M")


comb2324 %>%
  dplyr::filter(hc_euclid_ward, TotalEnrollment < 1500) %>%
  {
    ggplot(data=., aes(x=TeacherAvgYearsExp_School, y=MATH_ME_District, color=dist_colors)) +
      geom_point(aes(size=TotalEnrollment)) +
      stat_poly_line(method="rlm:M", fill="grey85") +
      theme_minimal() +
      theme(legend.position = "bottom") +
      geom_text_repel(aes(label=.data$district_name)) +
      scale_color_manual(values=district_name_colors, guide="none") +
      labs(x="Teacher Avg Years Exp", y="Percent Meets/Exceeds in Math") +
      ggtitle("Math Meets/Exceeds by Teacher Avg Years Exp", subtitle = paste0(sy, "; Source: NJ Dept of Ed.")) +
      scale_size_continuous(name = "District Size")
  }

```

```{r}
#| label: fig-math-vs-avgyears-dist
#| echo: true
#| message: false
#| warning: false
#| eval: true
#| cache: true
#| fig-height: 6
#| fig-cap: "Math vs Teacher Avg Years Exp in District"
#| code-summary: Code - Math vs Teacher Avg Years Exp in District 

# comb2324 %>% dplyr::filter(hc_euclid_ward, TotalEnrollment < 1500) %>% rlm(MATH_ME_District ~ TeacherAvgYearsExpInDistrict_School, data=., method = "M")


comb2324 %>%
  dplyr::filter(hc_euclid_ward, TotalEnrollment < 1500) %>%
  {
    ggplot(data=., aes(x=TeacherAvgYearsExpInDistrict_School, y=MATH_ME_District, color=dist_colors)) +
      geom_point(aes(size=TotalEnrollment)) +
      stat_poly_line(method="rlm:M", fill="grey85") +
      theme_minimal() +
      theme(legend.position = "bottom") +
      geom_text_repel(aes(label=.data$district_name)) +
      scale_color_manual(values=district_name_colors, guide="none") +
      labs(x="Teacher Avg Years Exp in District", y="Percent Meets/Exceeds in Math") +
      ggtitle("Math Meets/Exceeds by Teacher Avg Years Exp in District", subtitle = paste0(sy, "; Source: NJ Dept of Ed.")) +
      scale_size_continuous(name = "District Size")
  }
```

```{r}
#| label: fig-mathgrowth-vs-avgyears
#| echo: true
#| message: false
#| warning: false
#| eval: true
#| cache: true
#| fig-height: 6
#| fig-cap: "Math Growth vs Teacher Avg Years Exp"
#| code-summary: Code - Math Growth vs Teacher Avg Years Exp

# comb2324 %>% dplyr::filter(hc_euclid_ward, TotalEnrollment < 1500) %>% rlm(mSGP_Math ~ TeacherAvgYearsExp_School, data=., method = "M")

comb2324 %>%
  dplyr::filter(hc_euclid_ward, TotalEnrollment < 1500) %>%
  {
    ggplot(data=., aes(x=TeacherAvgYearsExp_School, y=mSGP_Math, color=dist_colors)) +
      geom_point(aes(size=TotalEnrollment)) +
      stat_poly_line(method="rlm:M", fill="grey85") +
      theme_minimal() +
      theme(legend.position = "bottom") +
      geom_text_repel(aes(label=.data$district_name)) +
      scale_color_manual(values=district_name_colors, guide="none") +
      labs(x="Teacher Avg Years Exp", y="Math Student Growth Percentile") +
      ggtitle("Math Growth by Teacher Avg Years Exp", subtitle = paste0(sy, "; Source: NJ Dept of Ed.")) +
      scale_size_continuous(name = "District Size")
  }

```

```{r}
#| label: fig-math-vs-chronicabs
#| echo: true
#| message: false
#| warning: false
#| eval: true
#| cache: true
#| fig-height: 6
#| fig-cap: "Math vs Chronic Absenteeism"
#| code-summary: Code - Math vs Chronic Absenteeism

comb2324 %>% dplyr::filter(hc_euclid_ward, TotalEnrollment < 1500) %>% rlm(MATH_ME_District ~ Chronic_Abs_Pct, data=., method = "M")

comb2324 %>%
  dplyr::filter(hc_euclid_ward, TotalEnrollment < 1500) %>%
  {
    ggplot(data=., aes(x=Chronic_Abs_Pct, y=MATH_ME_District, color=dist_colors)) +
      geom_point(aes(size=TotalEnrollment)) +
      stat_poly_line(method="rlm:M", fill="grey85") +
      theme_minimal() +
      geom_text_repel(aes(label=.data$district_name)) +
      scale_color_manual(values=district_name_colors, guide="none") +
      labs(x="Chronic Absent Pct", y="Percent Meets/Exceeds in Math") +
      ggtitle("Percent Math Meets/Exceeds by Chronic Absent Pct", subtitle = paste0(sy, "; Source: NJ Dept of Ed.")) +
      scale_size_continuous(guide="none")
  }

```

```{r}
#| label: fig-math-vs-chronicabs-all
#| echo: true
#| message: false
#| warning: false
#| eval: true
#| cache: true
#| fig-height: 6
#| fig-cap: "Math vs Chronic Absenteeism - All Districts"
#| code-summary: Code - Math vs Chronic Absenteeism - All Districts

# comb2324 %>% rlm(MATH_ME_District ~ Chronic_Abs_Pct, data=., method = "M")

comb2324 %>%
  {
    ggplot(data=., aes(x=Chronic_Abs_Pct, y=MATH_ME_District, color=dist_colors)) +
      geom_point(aes(size=TotalEnrollment)) +
      stat_poly_line(method="rlm:M", fill="grey85") +
      theme_minimal() +
      geom_text_repel(aes(label=.data$district_name)) +
      scale_color_manual(values=district_name_colors, guide="none") +
      labs(x="Chronic Absent Pct", y="Percent Meets/Exceeds in Math") +
      ggtitle("Percent Math Meets/Exceeds by Chronic Absent Pct", subtitle = paste0(sy, "; Source: NJ Dept of Ed.")) +
      scale_size_continuous(guide="none")
  }

```

# Outcomes and Inputs ELA

```{r}
#| label: fig-ela-vs-perpupil
#| echo: true
#| message: false
#| warning: false
#| eval: true
#| cache: true
#| fig-height: 6
#| fig-cap: "ELA vs Per Pupil Expenditure"
#| code-summary: Code - ELA vs Per Pupil Expenditure

# comb2324 %>% dplyr::filter(hc_euclid_ward, TotalEnrollment < 1500) %>% rlm(ELA_ME_District ~ I(per_pupil_cost/1000), data=., method = "M")

comb2324 %>%
  dplyr::filter(hc_euclid_ward, TotalEnrollment < 1500) %>%
  {
    ggplot(data=., aes(x=per_pupil_cost, y=ELA_ME_District, color=dist_colors)) +
      geom_point(aes(size=TotalEnrollment)) +
      stat_poly_line(method="rlm:M", fill="grey85") +
      #stat_poly_eq(use_label(c("eq")), method="rlm:M",  label.x = .8, label.y=1, color="black") +
      theme_minimal() +
      theme(legend.position = "bottom") +
      geom_text_repel(aes(label=.data$district_name)) +
      scale_color_manual(values=district_name_colors, guide="none") +
      labs(x="Per Pupil Expenditure", y="Percent Meets/Exceeds in ELA") +
      ggtitle("ELA Meets/Exceeds by Per Pupil Expenditure", subtitle = paste0(sy, "; Source: NJ Dept of Ed.")) +
      scale_size_continuous(name = "District Size")
  }

```

```{r}
#| label: fig-ela-vs-perpupil-all
#| echo: true
#| message: false
#| warning: false
#| eval: true
#| cache: true
#| fig-height: 6
#| fig-cap: "ELA vs Per Pupil Expenditure - All Districts"
#| code-summary: Code - ELA vs Per Pupil Expenditure - All Districts

# comb2324 %>% rlm(ELA_ME_District ~ I(per_pupil_cost/1000), data=., method = "M")

comb2324 %>%
  {
    ggplot(data=., aes(x=per_pupil_cost, y=ELA_ME_District, color=dist_colors)) +
      geom_point(aes(size=TotalEnrollment)) +
      stat_poly_line(method="rlm:M", fill="grey85") +
      #stat_poly_eq(use_label(c("eq")), method="rlm:M",  label.x = .8, label.y=1, color="black") +
      theme_minimal() +
      theme(legend.position = "bottom") +
      geom_text_repel(aes(label=.data$district_name)) +
      scale_color_manual(values=district_name_colors, guide="none") +
      labs(x="Per Pupil Expenditure", y="Percent Meets/Exceeds in ELA") +
      ggtitle("ELA Meets/Exceeds by Per Pupil Expenditure", subtitle = paste0(sy, "; Source: NJ Dept of Ed.")) +
      scale_size_continuous(name = "District Size")
  }

```

```{r}
#| label: fig-ela-vs-medianincome-all
#| echo: true
#| message: false
#| warning: false
#| eval: true
#| cache: true
#| fig-height: 6
#| fig-cap: "ELA vs Median Family Income - All Districts"
#| code-summary: Code - ELA vs Median Family Income - All Districts

# comb2324 %>% rlm(ELA_ME_District ~ I(Fam_Med_Income/1000), data=., method = "M")

comb2324 %>%
  {
    ggplot(data=., aes(x=Fam_Med_Income, y=ELA_ME_District, color=dist_colors)) +
      geom_point(aes(size=TotalEnrollment)) +
      stat_poly_line(method="rlm:M", fill="grey85") +
      #stat_poly_eq(use_label(c("eq")), method="rlm:M",  label.x = .8, label.y=1, color="black") +
      theme_minimal() +
      theme(legend.position = "bottom") +
      geom_text_repel(aes(label=.data$district_name)) +
      scale_color_manual(values=district_name_colors, guide="none") +
      labs(x="Median Family Income", y="Percent Meets/Exceeds in ELA") +
      ggtitle("ELA Meets/Exceeds by Median Family Income", subtitle = paste0(sy, "; Sources: NJ Dept of Ed., ACS-EDGE")) +
      scale_size_continuous(name = "District Size") +
      scale_x_continuous(labels = scales::dollar, expand = expansion(mult = c(0, 0.1)))
  }

```

```{r}
#| label: fig-ela-vs-perpupil-exceeds
#| echo: true
#| message: false
#| warning: false
#| eval: true
#| cache: true
#| fig-height: 6
#| fig-cap: "ELA Exceeds vs Per Pupil Expenditure"
#| code-summary: Code - ELA Exceeds vs Per Pupil Expenditure

# comb2324 %>% dplyr::filter(hc_euclid_ward, TotalEnrollment < 1500) %>% rlm(ELA_pct_level5 ~ I(per_pupil_cost/1000), data=., method = "M")

comb2324 %>%
  dplyr::filter(hc_euclid_ward, TotalEnrollment < 1500) %>%
  {
    ggplot(data=., aes(x=per_pupil_cost, y=ELA_pct_level5, color=dist_colors)) +
      geom_point(aes(size=TotalEnrollment)) +
      stat_poly_line(method="rlm:M", fill="grey85") +
      #stat_poly_eq(use_label(c("eq")), method="rlm:M",  label.x = .8, label.y=1, color="black") +
      theme_minimal() +
      theme(legend.position = "bottom") +
      geom_text_repel(aes(label=.data$district_name)) +
      scale_color_manual(values=district_name_colors, guide="none") +
      labs(x="Per Pupil Expenditure", y="Percent Exceeds in ELA") +
      ggtitle("ELA Exceeds by Per Pupil Expenditure", subtitle = paste0(sy, "; Source: NJ Dept of Ed.")) +
      scale_size_continuous(name = "District Size") +
      scale_y_continuous(labels = scales::label_percent(accuracy = 1)) +
      scale_x_continuous(labels = scales::dollar, expand = expansion(mult = c(0, 0.1)))
  }

```

```{r}
#| label: fig-elasgp-vs-perpupil
#| echo: true
#| message: false
#| warning: false
#| eval: true
#| cache: true
#| fig-height: 6
#| fig-cap: "ELA Growth Percentile vs Per Pupil Expenditure"
#| code-summary: Code - ELA Growth Percentile vs Per Pupil Expenditure

# comb2324 %>% dplyr::filter(hc_euclid_ward, TotalEnrollment < 1500) %>% rlm(mSGP_ELA ~ I(per_pupil_cost/1000), data=., method = "M")

comb2324 %>%
  dplyr::filter(hc_euclid_ward, TotalEnrollment < 1500) %>%
  {
    ggplot(data=., aes(x=per_pupil_cost, y=mSGP_ELA, color=dist_colors)) +
      geom_point(aes(size=TotalEnrollment)) +
      stat_poly_line(method="rlm:M", fill="grey85") +
      #stat_poly_eq(use_label(c("eq")), method="rlm:M",  label.x = .8, label.y=1, color="black") +
      theme_minimal() +
      theme(legend.position = "bottom") +
      geom_text_repel(aes(label=.data$district_name)) +
      scale_color_manual(values=district_name_colors, guide="none") +
      labs(x="Per Pupil Expenditure", y="ELA Growth Percentile") +
      ggtitle("ELA Growth Percentile by Per Pupil Expenditure", subtitle = paste0(sy, "; Source: NJ Dept of Ed.")) +
      scale_size_continuous(name = "District Size") +
      scale_x_continuous(labels = scales::dollar, expand = expansion(mult = c(0, 0.1)))
  }


```

```{r}
#| label: fig-elasgp-vs-perpupil-all
#| echo: true
#| message: false
#| warning: false
#| eval: true
#| cache: true
#| fig-height: 6
#| fig-cap: "ELA Growth Percentile vs Per Pupil Expenditure - All"
#| code-summary: Code - ELA Growth Percentile vs Per Pupil Expenditure - All

# comb2324 %>% rlm(mSGP_ELA ~ I(per_pupil_cost/1000), data=., method = "M")

comb2324 %>%
  {
    ggplot(data=., aes(x=per_pupil_cost, y=mSGP_ELA, color=dist_colors)) +
      geom_point(aes(size=TotalEnrollment)) +
      stat_poly_line(method="rlm:M", fill="grey85") +
      theme_minimal() +
      theme(legend.position = "bottom") +
      geom_text_repel(aes(label=.data$district_name)) +
      scale_color_manual(values=district_name_colors, guide="none") +
      labs(x="Per Pupil Expenditure", y="ELA Growth Percentile") +
      ggtitle("ELA Growth Percentile by Per Pupil Expenditure", subtitle = paste0(sy, "; Source: NJ Dept of Ed.")) +
      scale_size_continuous(name = "District Size") +
      scale_x_continuous(labels = scales::dollar, expand = expansion(mult = c(0, 0.1)))
  }

```

```{r}
#| label: fig-ela-vs-percentint
#| echo: true
#| message: false
#| warning: false
#| eval: true
#| cache: true
#| fig-height: 6
#| fig-cap: "ELA vs Percent Expenditure to Instruction"
#| code-summary: Code - ELA vs Percent Expenditure to Instruction

# comb2324 %>% dplyr::filter(hc_euclid_ward, TotalEnrollment < 1500) %>% rlm(ELA_ME_District ~ I(per_pupil_class_instruction/ per_pupil_cost), data=., method = "M")

comb2324 %>%
  dplyr::filter(hc_euclid_ward, TotalEnrollment < 1500) %>%
  dplyr::mutate(inst_pct = per_pupil_class_instruction/ per_pupil_cost) %>%
  {
    ggplot(data=., aes(x=inst_pct, y=ELA_ME_District, color=dist_colors)) +
      geom_point(aes(size=TotalEnrollment)) +
      stat_poly_line(method="rlm:M", fill="grey85") +
      theme_minimal() +
      theme(legend.position = "bottom") +
      geom_text_repel(aes(label=.data$district_name)) +
      scale_color_manual(values=district_name_colors, guide="none") +
      labs(x="Percent Instruction", y="Percent Meets/Exceeds in ELA") +
      ggtitle("ELA Meets/Exceeds by Percent Instruction", subtitle = paste0(sy, "; Source: NJ Dept of Ed.")) +
      scale_size_continuous(name = "District Size") +
      scale_x_continuous(labels = scales::label_percent(accuracy = 1))
  }

```

```{r}
#| label: fig-ela-vs-avgyears
#| echo: true
#| message: false
#| warning: false
#| eval: true
#| cache: true
#| fig-height: 6
#| fig-cap: "ELA vs Teacher Avg Years Exp"
#| code-summary: Code - ELA vs Teacher Avg Years Exp

# comb2324 %>% dplyr::filter(hc_euclid_ward, TotalEnrollment < 1500) %>% rlm(ELA_ME_District ~ TeacherAvgYearsExp_School, data=., method = "M")


comb2324 %>%
  dplyr::filter(hc_euclid_ward, TotalEnrollment < 1500) %>%
  {
    ggplot(data=., aes(x=TeacherAvgYearsExp_School, y=ELA_ME_District, color=dist_colors)) +
      geom_point(aes(size=TotalEnrollment)) +
      stat_poly_line(method="rlm:M", fill="grey85") +
      theme_minimal() +
      theme(legend.position = "bottom") +
      geom_text_repel(aes(label=.data$district_name)) +
      scale_color_manual(values=district_name_colors, guide="none") +
      labs(x="Teacher Avg Years Exp", y="Percent Meets/Exceeds in ELA") +
      ggtitle("ELA Meets/Exceeds by Teacher Avg Years Exp", subtitle = paste0(sy, "; Source: NJ Dept of Ed.")) +
      scale_size_continuous(name = "District Size")
  }

```

```{r}
#| label: fig-ela-vs-avgyears-dist
#| echo: true
#| message: false
#| warning: false
#| eval: true
#| cache: true
#| fig-height: 6
#| fig-cap: "ELA vs Teacher Avg Years Exp in District"
#| code-summary: Code - ELA vs Teacher Avg Years Exp in District 

# comb2324 %>% dplyr::filter(hc_euclid_ward, TotalEnrollment < 1500) %>% rlm(ELA_ME_District ~ TeacherAvgYearsExpInDistrict_School, data=., method = "M")


comb2324 %>%
  dplyr::filter(hc_euclid_ward, TotalEnrollment < 1500) %>%
  {
    ggplot(data=., aes(x=TeacherAvgYearsExpInDistrict_School, y=ELA_ME_District, color=dist_colors)) +
      geom_point(aes(size=TotalEnrollment)) +
      stat_poly_line(method="rlm:M", fill="grey85") +
      theme_minimal() +
      theme(legend.position = "bottom") +
      geom_text_repel(aes(label=.data$district_name)) +
      scale_color_manual(values=district_name_colors, guide="none") +
      labs(x="Teacher Avg Years Exp in District", y="Percent Meets/Exceeds in ELA") +
      ggtitle("ELA Meets/Exceeds by Teacher Avg Years Exp in District", subtitle = paste0(sy, "; Source: NJ Dept of Ed.")) +
      scale_size_continuous(name = "District Size")
  }
```

```{r}
#| label: fig-elagrowth-vs-avgyears
#| echo: true
#| message: false
#| warning: false
#| eval: true
#| cache: true
#| fig-height: 6
#| fig-cap: "ELA Growth vs Teacher Avg Years Exp"
#| code-summary: Code - ELA Growth vs Teacher Avg Years Exp

# comb2324 %>% dplyr::filter(hc_euclid_ward, TotalEnrollment < 1500) %>% rlm(mSGP_ELA ~ TeacherAvgYearsExp_School, data=., method = "M")

comb2324 %>%
  dplyr::filter(hc_euclid_ward, TotalEnrollment < 1500) %>%
  {
    ggplot(data=., aes(x=TeacherAvgYearsExp_School, y=mSGP_ELA, color=dist_colors)) +
      geom_point(aes(size=TotalEnrollment)) +
      stat_poly_line(method="rlm:M", fill="grey85") +
      theme_minimal() +
      theme(legend.position = "bottom") +
      geom_text_repel(aes(label=.data$district_name)) +
      scale_color_manual(values=district_name_colors, guide="none") +
      labs(x="Teacher Avg Years Exp", y="ELA Student Growth Percentile") +
      ggtitle("ELA Growth by Teacher Avg Years Exp", subtitle = paste0(sy, "; Source: NJ Dept of Ed.")) +
      scale_size_continuous(name = "District Size")
  }

```

```{r}
#| label: fig-ela-vs-chronicabs
#| echo: true
#| message: false
#| warning: false
#| eval: true
#| cache: true
#| fig-height: 6
#| fig-cap: "ELA vs Chronic Absenteeism"
#| code-summary: Code - ELA vs Chronic Absenteeism

comb2324 %>% dplyr::filter(hc_euclid_ward, TotalEnrollment < 1500) %>% rlm(ELA_ME_District ~ Chronic_Abs_Pct, data=., method = "M")

comb2324 %>%
  dplyr::filter(hc_euclid_ward, TotalEnrollment < 1500) %>%
  {
    ggplot(data=., aes(x=Chronic_Abs_Pct, y=ELA_ME_District, color=dist_colors)) +
      geom_point(aes(size=TotalEnrollment)) +
      stat_poly_line(method="rlm:M", fill="grey85") +
      theme_minimal() +
      geom_text_repel(aes(label=.data$district_name)) +
      scale_color_manual(values=district_name_colors, guide="none") +
      labs(x="Chronic Absent Pct", y="Percent Meets/Exceeds in ELA") +
      ggtitle("Percent ELA Meets/Exceeds by Chronic Absent Pct", subtitle = paste0(sy, "; Source: NJ Dept of Ed.")) +
      scale_size_continuous(guide="none")
  }

```

```{r}
#| label: fig-ela-vs-chronicabs-all
#| echo: true
#| message: false
#| warning: false
#| eval: true
#| cache: true
#| fig-height: 6
#| fig-cap: "ELA vs Chronic Absenteeism - All Districts"
#| code-summary: Code - ELA vs Chronic Absenteeism - All Districts

# comb2324 %>% rlm(ELA_ME_District ~ Chronic_Abs_Pct, data=., method = "M")

comb2324 %>%
  {
    ggplot(data=., aes(x=Chronic_Abs_Pct, y=ELA_ME_District, color=dist_colors)) +
      geom_point(aes(size=TotalEnrollment)) +
      stat_poly_line(method="rlm:M", fill="grey85") +
      theme_minimal() +
      geom_text_repel(aes(label=.data$district_name)) +
      scale_color_manual(values=district_name_colors, guide="none") +
      labs(x="Chronic Absent Pct", y="Percent Meets/Exceeds in ELA") +
      ggtitle("Percent ELA Meets/Exceeds by Chronic Absent Pct", subtitle = paste0(sy, "; Source: NJ Dept of Ed.")) +
      scale_size_continuous(guide="none")
  }

```
